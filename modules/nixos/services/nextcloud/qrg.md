NixOS Options
────────────────────
# services.nextcloud.settings.trusted_proxies
Trusted proxies, to provide if the nextcloud installation is being
proxied to secure against e.g. spoofing.

type: list of string


NixOS Options
────────────────────
# services.nextcloud.fastcgiTimeout
FastCGI timeout for database connection in seconds.

type: signed integer


NixOS Options
────────────────────
# services.nextcloud.notify_push.dbtableprefix
Table prefix in Nextcloud's database.
type: null or string


NixOS Options
────────────────────
# services.nextcloud.notify_push.socketPath
Socket path to use for notify_push
type: string


NixOS Options
────────────────────
# services.nextcloud.extraApps
Extra apps to install. Should be an attrSet of appid to packages generated by fetchNextcloudApp.
The appid must be identical to the "id" value in the apps appinfo/info.xml.
Using this will disable the appstore to prevent Nextcloud from updating these apps (see [](#opt-services.nextcloud.appstoreEnable)).

type: attribute set of package


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.usePathStyle
Required for some non-Amazon S3 implementations.

Ordinarily, requests will be made with
`http://bucket.hostname.domain/`, but with path style
enabled requests are made with
`http://hostname.domain/bucket` instead.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.package
Which package to use for the Nextcloud instance.
type: package


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.sseCKeyFile
If provided this is the full path to a file that contains the key
to enable [server-side encryption with customer-provided keys][1]
(SSE-C).

The file must contain a random 32-byte key encoded as a base64
string, e.g. generated with the command

```
openssl rand 32 | base64
```

Must be readable by user `nextcloud`.

[1]: https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerSideEncryptionCustomerKeys.html

type: null or path


NixOS Options
────────────────────
# services.nextcloud.enableImagemagick
Whether to enable the ImageMagick module for PHP.
This is used by the theming app and for generating previews of certain images (e.g. SVG and HEIF).
You may want to disable it for increased security. In that case, previews will still be available
for some images (e.g. JPEG and PNG).
See <https://github.com/nextcloud/server/issues/13099>.
.
type: boolean


NixOS Options
────────────────────
# services.nextcloud.enable
Whether to enable nextcloud.
type: boolean


NixOS Options
────────────────────
# services.nextcloud.config.dbuser
Database user.
type: null or string


NixOS Options
────────────────────
# services.nextcloud.poolConfig
Options for Nextcloud's PHP pool. See the documentation on `php-fpm.conf` for details on configuration directives.

type: null or strings concatenated with "\n"


NixOS Options
────────────────────
# services.nextcloud.settings
Extra options which should be appended to Nextcloud's config.php file.

type: JSON value


NixOS Options
────────────────────
# services.nextcloud.notify_push.dbuser
Database user.
type: null or string


NixOS Options
────────────────────
# services.nextcloud.config.dbtableprefix
Table prefix in Nextcloud's database.
type: null or string


NixOS Options
────────────────────
# services.nextcloud.caching.memcached
Whether to load the Memcached module into PHP.
You still need to enable Memcached in your config.php.
See https://docs.nextcloud.com/server/14/admin_manual/configuration_server/caching_configuration.html

type: boolean


NixOS Options
────────────────────
# services.nextcloud.datadir
Nextcloud's data storage path.  Will be [](#opt-services.nextcloud.home) by default.
This folder will be populated with a config.php file and a data folder which contains the state of the instance (excluding the database).";

type: string


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.enable
Whether to enable S3 object storage as primary storage.

This mounts a bucket on an Amazon S3 object storage or compatible
implementation into the virtual filesystem.

Further details about this feature can be found in the
[upstream documentation](https://docs.nextcloud.com/server/22/admin_manual/configuration_files/primary_storage.html).
.
type: boolean


NixOS Options
────────────────────
# services.nextcloud.config.adminuser
Username for the admin account. The username is only set during the
initial setup of Nextcloud! Since the username also acts as unique
ID internally, it cannot be changed later!

type: string


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.secretFile
The full path to a file that contains the access secret. Must be
readable by user `nextcloud`.

type: string


NixOS Options
────────────────────
# services.nextcloud.configureRedis
Whether to configure Nextcloud to use the recommended Redis settings for small instances.

::: {.note}
The `notify_push` app requires Redis to be configured. If this option is turned off, this must be configured manually.
:::

type: boolean


NixOS Options
────────────────────
# services.nextcloud.settings.skeletondirectory
The directory where the skeleton files are located. These files will be
copied to the data directory of new users. Leave empty to not copy any
skeleton files.

type: string


NixOS Options
────────────────────
# services.nextcloud.config.adminpassFile
The full path to a file that contains the admin's password. Must be
readable by user `nextcloud`. The password is set only in the initial
setup of Nextcloud by the systemd service `nextcloud-setup.service`.

type: string


NixOS Options
────────────────────
# services.nextcloud.notify_push.dbhost
Database host (+port) or socket path.
If [](#opt-services.nextcloud.database.createLocally) is true and
[](#opt-services.nextcloud.config.dbtype) is either `pgsql` or `mysql`,
defaults to the correct Unix socket instead.

type: null or string


NixOS Options
────────────────────
# services.nextcloud.notify_push.enable
Whether to enable Notify push.
type: boolean


NixOS Options
────────────────────
# services.nextcloud.caching.apcu
Whether to load the APCu module into PHP.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.notify_push.bendDomainToLocalhost
Whether to add an entry to `/etc/hosts` for the configured nextcloud domain to point to `localhost` and add `localhost `to nextcloud's `trusted_proxies` config option.

This is useful when nextcloud's domain is not a static IP address and when the reverse proxy cannot be bypassed because the backend connection is done via unix socket.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.settings.default_phone_region
An [ISO 3166-1](https://www.iso.org/iso-3166-country-codes.html)
country code which replaces automatic phone-number detection
without a country code.

As an example, with `DE` set as the default phone region,
the `+49` prefix can be omitted for phone numbers.

type: string


NixOS Options
────────────────────
# services.nextcloud.notify_push.dbtype
Database type.
type: one of "sqlite", "pgsql", "mysql"


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.key
The access key for the S3 bucket.

type: string


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.useSsl
Use SSL for objectstore access.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.config.dbhost
Database host (+port) or socket path.
If [](#opt-services.nextcloud.database.createLocally) is true and
[](#opt-services.nextcloud.config.dbtype) is either `pgsql` or `mysql`,
defaults to the correct Unix socket instead.

type: null or string


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.region
Required for some non-Amazon implementations.

type: null or string


NixOS Options
────────────────────
# services.nextcloud.caching.redis
Whether to load the Redis module into PHP.
You still need to enable Redis in your config.php.
See https://docs.nextcloud.com/server/14/admin_manual/configuration_server/caching_configuration.html

type: boolean


NixOS Options
────────────────────
# services.nextcloud.poolSettings
Options for nextcloud's PHP pool. See the documentation on `php-fpm.conf` for details on configuration directives.

type: attribute set of (string or signed integer or boolean)


NixOS Options
────────────────────
# services.nextcloud.appstoreEnable
Allow the installation and updating of apps from the Nextcloud appstore.
Enabled by default unless there are packages in [](#opt-services.nextcloud.extraApps).
Set this to true to force enable the store even if [](#opt-services.nextcloud.extraApps) is used.
Set this to false to disable the installation of apps from the global appstore. App management is always enabled regardless of this setting.

type: null or boolean


NixOS Options
────────────────────
# services.nextcloud.notify_push.package
Which package to use for notify_push
type: package


NixOS Options
────────────────────
# services.nextcloud.extraAppsEnable
Automatically enable the apps in [](#opt-services.nextcloud.extraApps) every time Nextcloud starts.
If set to false, apps need to be enabled in the Nextcloud web user interface or with `nextcloud-occ app:enable`.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.config.dbname
Database name.
type: null or string


NixOS Options
────────────────────
# services.nextcloud.settings.overwriteprotocol
Force Nextcloud to always use HTTP or HTTPS i.e. for link generation.
Nextcloud uses the currently used protocol by default, but when
behind a reverse-proxy, it may use `http` for everything although
Nextcloud may be served via HTTPS.

type: one of "", "http", "https"


NixOS Options
────────────────────
# services.nextcloud.phpExtraExtensions
Additional PHP extensions to use for Nextcloud.
By default, only extensions necessary for a vanilla Nextcloud installation are enabled,
but you may choose from the list of available extensions and add further ones.
This is sometimes necessary to be able to install a certain Nextcloud app that has additional requirements.

type: function that evaluates to a(n) list of package


NixOS Options
────────────────────
# services.nextcloud.webfinger
Enable this option if you plan on using the webfinger plugin.
The appropriate nginx rewrite rules will be added to your configuration.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.hostName
FQDN for the nextcloud instance.
type: string


NixOS Options
────────────────────
# services.nextcloud.nginx.hstsMaxAge
Value for the `max-age` directive of the HTTP
`Strict-Transport-Security` header.

See section 6.1.1 of IETF RFC 6797 for detailed information on this
directive and header.

type: positive integer, meaning >0


NixOS Options
────────────────────
# services.nextcloud.database.createLocally
Whether to create the database and database user locally.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.home
Storage path of nextcloud.
type: string


NixOS Options
────────────────────
# services.nextcloud.https
Use HTTPS for generated links.
type: boolean


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.autocreate
Create the objectstore if it does not exist.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.notify_push.logLevel
Log level
type: one of "error", "warn", "info", "debug", "trace"


NixOS Options
────────────────────
# services.nextcloud.nginx.recommendedHttpHeaders
Enable additional recommended HTTP response headers
type: boolean


NixOS Options
────────────────────
# services.nextcloud.notify_push.dbname
Database name.
type: null or string


NixOS Options
────────────────────
# services.nextcloud.secretFile
Secret options which will be appended to Nextcloud's config.php file (written as JSON, in the same
form as the [](#opt-services.nextcloud.settings) option), for example
`{"redis":{"password":"secret"}}`.

type: null or string


NixOS Options
────────────────────
# services.nextcloud.notify_push.dbpassFile
The full path to a file that contains the database password.

type: null or string


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.bucket
The name of the S3 bucket.

type: string


NixOS Options
────────────────────
# services.nextcloud.settings.profile.enabled
Makes user-profiles globally available under `nextcloud.tld/u/user.name`.
Even though it's enabled by default in Nextcloud, it must be explicitly enabled
here because it has the side-effect that personal information is even accessible to
unauthenticated users by default.
By default, the following properties are set to “Show to everyone”
if this flag is enabled:
- About
- Full name
- Headline
- Organisation
- Profile picture
- Role
- Twitter
- Website
Only has an effect in Nextcloud 23 and later.

type: boolean


NixOS Options
────────────────────
# services.nextcloud.autoUpdateApps.startAt
When to run the update. See `systemd.services.<name>.startAt`.

type: string or list of string


NixOS Options
────────────────────
# services.nextcloud.maxUploadSize
The upload limit for files. This changes the relevant options
in php.ini and nginx if enabled.

type: string


NixOS Options
────────────────────
# services.nextcloud.settings.log_type
Logging backend to use.
systemd requires the php-systemd package to be added to services.nextcloud.phpExtraExtensions.
See the [nextcloud documentation](https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/logging_configuration.html) for details.

type: one of "errorlog", "file", "syslog", "systemd"


NixOS Options
────────────────────
# services.nextcloud.settings.trusted_domains
Trusted domains, from which the nextcloud installation will be
accessible. You don't need to add
`services.nextcloud.hostname` here.

type: list of string


NixOS Options
────────────────────
# services.nextcloud.phpOptions
Options for PHP's php.ini file for nextcloud.

Please note that this option is _additive_ on purpose while the
attribute values inside the default are option defaults: that means that

```nix
{
  services.nextcloud.phpOptions."opcache.interned_strings_buffer" = "23";
}
```

will override the `php.ini` option `opcache.interned_strings_buffer` without
discarding the rest of the defaults.

Overriding all of `phpOptions` (including `upload_max_filesize`, `post_max_size`
and `memory_limit` which all point to [](#opt-services.nextcloud.maxUploadSize)
by default) can be done like this:

```nix
{
  services.nextcloud.phpOptions = lib.mkForce {
    /* ... */
  };
}
```

type: attribute set of (string or signed integer)


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.hostname
Required for some non-Amazon implementations.

type: null or string


NixOS Options
────────────────────
# services.nextcloud.config.dbpassFile
The full path to a file that contains the database password.

type: null or string


NixOS Options
────────────────────
# services.nextcloud.config.dbtype
Database type.
type: one of "sqlite", "pgsql", "mysql"


NixOS Options
────────────────────
# services.nextcloud.phpPackage
The php package to use.
type: package


NixOS Options
────────────────────
# services.nextcloud.settings.loglevel
Log level value between 0 (DEBUG) and 4 (FATAL).

- 0 (debug): Log all activity.

- 1 (info): Log activity such as user logins and file activities, plus warnings, errors, and fatal errors.

- 2 (warn): Log successful operations, as well as warnings of potential problems, errors and fatal errors.

- 3 (error): Log failed operations and fatal errors.

- 4 (fatal): Log only fatal errors that cause the server to stop.

type: integer between 0 and 4 (both inclusive)


NixOS Options
────────────────────
# services.nextcloud.config.objectstore.s3.port
Required for some non-Amazon implementations.

type: null or 16 bit unsigned integer; between 0 and 65535 (both inclusive)


NixOS Options
────────────────────
# services.nextcloud.autoUpdateApps.enable
Run a regular auto-update of all apps installed from the Nextcloud app store.

type: boolean


